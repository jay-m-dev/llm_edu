<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tokenizer Prototype</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="container">
      <div id="error-screen" class="onboarding-overlay" hidden>
        <div class="onboarding-modal">
          <div class="generation-title">Something went wrong</div>
          <div id="error-message" class="sampling-result"></div>
          <div class="onboarding-actions">
            <button id="error-reset" class="generation-button" type="button">Reset</button>
          </div>
        </div>
      </div>
      <div id="onboarding" class="onboarding-overlay" hidden>
        <div class="onboarding-modal">
          <div id="onboarding-step" class="generation-title"></div>
          <div id="onboarding-body" class="sampling-result"></div>
          <div class="onboarding-actions">
            <button id="onboarding-skip" class="generation-button" type="button">Skip</button>
            <button id="onboarding-next" class="generation-button" type="button">Next</button>
          </div>
        </div>
      </div>
      <header>
        <h1>Tokenizer Prototype</h1>
        <p class="lede">A minimal, deterministic tokenizer with a visual token list.</p>
      </header>

      <div class="grid">
        <section class="panel">
          <label for="input">Input Text</label>
          <textarea id="input" spellcheck="false"></textarea>
        </section>

        <section class="panel panel-stack">
          <div class="token-header">
            <span>Tokens</span>
            <span>Count: <span id="token-count">0</span></span>
          </div>
          <div id="failure-banner" class="failure-banner" hidden>
            <div class="failure-title"></div>
            <div class="failure-cause"></div>
            <div class="failure-hint"></div>
            <button id="failure-retry" class="generation-button" type="button">Try Again</button>
          </div>
          <div class="sandbox-banner" id="sandbox-banner" hidden>Sandbox mode: objectives and scoring disabled.</div>
          <div class="sandbox-toggle">
            <label class="context-label" for="sandbox-mode" data-tooltip="Enable free play with all controls unlocked.">Sandbox mode</label>
            <input id="sandbox-mode" type="checkbox" />
          </div>
          <div id="unlock-toast" class="unlock-toast" hidden></div>
          <div class="context-controls">
            <label class="context-label" for="context-size" data-tooltip="Controls how many recent tokens remain visible.">
              Context size
              <span id="lock-context-size" class="lock-badge">Locked</span>
            </label>
            <div class="slider-row">
              <input id="context-size" class="context-input" type="number" min="0" max="200" value="12" />
              <input id="context-size-slider" class="slider-input" type="range" min="0" max="200" value="12" />
              <span id="context-size-value" class="slider-value">12</span>
            </div>
          </div>
          <div id="token-list" class="token-list"></div>

          <div id="embedding-panel" class="embedding-panel">
            <div id="embedding-title" class="embedding-title"></div>
            <div id="embedding-bars" class="embedding-bars"></div>
          </div>

          <div id="attention-panel" class="attention-panel">
            <div class="attention-title">Attention Weights</div>
            <div id="attention-list" class="attention-list"></div>
          </div>

          <div id="pipeline-panel" class="pipeline-panel">
            <div class="pipeline-header">
              <div class="pipeline-title">Pipeline Output</div>
              <select id="pipeline-stage" class="pipeline-select"></select>
            </div>
            <div id="pipeline-list" class="pipeline-list"></div>
          </div>

          <div id="context-panel" class="context-panel">
            <div class="context-title">Context Window</div>
            <div class="context-grid">
              <div>
                <div class="context-subtitle">Active</div>
                <div id="context-active" class="context-list"></div>
              </div>
              <div>
                <div class="context-subtitle">Dropped</div>
                <div id="context-dropped" class="context-list context-dropped"></div>
              </div>
            </div>
          </div>

          <div id="sampling-panel" class="sampling-panel">
            <div class="sampling-header">
              <div class="sampling-title">Sampling</div>
              <div id="replay-indicator" class="replay-indicator">Replay: off</div>
            </div>
            <div class="sampling-controls">
              <label class="sampling-label" for="sampling-seed" data-tooltip="Seed fixes randomness so runs are repeatable.">Seed</label>
              <input id="sampling-seed" class="sampling-input" type="number" value="12345" />
              <label class="sampling-label" for="sampling-temp" data-tooltip="Temperature reshapes probability spread.">
                Temperature
                <span id="lock-sampling-temp" class="lock-badge">Locked</span>
              </label>
              <div class="slider-row">
                <input id="sampling-temp" class="sampling-input" type="number" step="0.1" min="0.1" value="1" />
                <input id="sampling-temp-slider" class="slider-input" type="range" step="0.1" min="0.1" max="2" value="1" />
                <span id="sampling-temp-value" class="slider-value">1.0</span>
              </div>
              <label class="sampling-label" for="sampling-random" data-tooltip="Randomness adds noise to token choice.">
                Randomness
                <span id="lock-sampling-random" class="lock-badge">Locked</span>
              </label>
              <div class="slider-row">
                <input id="sampling-random" class="sampling-input" type="number" step="0.05" min="0" max="1" value="0.2" />
                <input id="sampling-random-slider" class="slider-input" type="range" step="0.05" min="0" max="1" value="0.2" />
                <span id="sampling-random-value" class="slider-value">0.20</span>
              </div>
              <button id="sampling-run" class="sampling-button" type="button" data-tooltip="Run a single sampling draw.">Sample</button>
            </div>
            <div class="sampling-actions">
              <button id="run-save" class="sampling-button" type="button" data-tooltip="Save the current run for replay.">Record Run</button>
              <button id="run-replay" class="sampling-button" type="button" data-tooltip="Load the last saved run into replay.">Replay Last</button>
            </div>
            <div id="sampling-result" class="sampling-result">No sample yet.</div>
            <div id="sampling-list" class="sampling-list"></div>
          </div>

          <div id="generation-panel" class="generation-panel">
          <div class="generation-header">
              <div class="generation-title">Token-by-Token</div>
              <div class="generation-status">
                Step: <span id="generation-step">0</span>
                | Current: <span id="generation-current">-</span>
              </div>
            </div>
            <div class="generation-controls">
              <button id="generation-play" class="generation-button" type="button" data-tooltip="Play token generation automatically.">Play</button>
              <button id="generation-pause" class="generation-button" type="button" data-tooltip="Pause token generation.">Pause</button>
              <button id="generation-step-btn" class="generation-button" type="button" data-tooltip="Advance by one token.">Step</button>
              <label class="sampling-label" for="generation-speed">Speed</label>
              <input id="generation-speed" class="sampling-input" type="number" step="0.1" min="0.2" value="1" />
              <label class="sampling-label" for="hallucination-toggle" data-tooltip="Flags low-probability tokens as risky guesses.">Hallucination flags</label>
              <input id="hallucination-toggle" type="checkbox" checked />
            </div>
            <div id="generation-output" class="generation-output"></div>
            <div class="generation-probabilities">
              <div class="generation-prob-title">Step Probabilities</div>
              <div id="generation-prob-list" class="generation-prob-list"></div>
            </div>
            <div class="generation-attention">
              <div class="generation-prob-title">Step Attention</div>
              <div id="generation-attention-list" class="generation-prob-list"></div>
            </div>
            <div class="generation-heatmap">
              <div class="generation-prob-title">Attention Heatmap</div>
              <div id="attention-heatmap" class="heatmap-grid"></div>
              <div id="attention-heatmap-labels" class="heatmap-labels"></div>
            </div>
          </div>

          <div id="replay-panel" class="generation-panel">
            <div class="generation-header">
              <div class="generation-title">Replay Mode</div>
              <div id="replay-status" class="generation-status">Idle</div>
            </div>
            <div class="generation-controls">
              <button id="replay-play" class="generation-button" type="button" data-tooltip="Play the replay timeline.">Play</button>
              <button id="replay-pause" class="generation-button" type="button" data-tooltip="Pause replay.">Pause</button>
              <button id="replay-step" class="generation-button" type="button" data-tooltip="Step through replay.">Step</button>
              <label class="sampling-label" for="replay-speed" data-tooltip="Replay speed controls playback rate.">Speed</label>
              <input id="replay-speed" class="sampling-input" type="number" step="0.1" min="0.2" value="1" />
              <button id="replay-exit" class="generation-button" type="button" data-tooltip="Exit replay mode.">Exit Replay</button>
            </div>
            <div class="generation-output" id="replay-output"></div>
          </div>

          <div id="objectives-panel" class="generation-panel">
            <div class="generation-header">
              <div class="generation-title">Objectives</div>
              <button id="objectives-evaluate" class="generation-button" type="button" data-tooltip="Evaluate current objectives.">Evaluate</button>
            </div>
            <div id="objectives-list" class="objectives-list"></div>
          </div>

          <div id="diagnostics-panel" class="generation-panel">
            <div class="generation-header">
              <div class="generation-title">Diagnostics</div>
              <button id="diagnostics-evaluate" class="generation-button" type="button" data-tooltip="Check for failure conditions.">Check</button>
            </div>
            <div id="diagnostics-list" class="diagnostics-list"></div>
          </div>

          <div id="scores-panel" class="generation-panel">
            <div class="generation-header">
              <div class="generation-title">Scores</div>
              <button id="scores-evaluate" class="generation-button" type="button" data-tooltip="Score this run across dimensions.">Score Run</button>
            </div>
            <div id="scores-list" class="scores-list"></div>
          </div>

          <div id="saves-panel" class="generation-panel">
            <div class="generation-header">
              <div class="generation-title">Saves</div>
              <button id="save-run" class="generation-button" type="button">Save Run</button>
            </div>
            <div id="saves-message" class="sampling-result"></div>
            <div id="saves-list" class="scores-list"></div>
          </div>

          <div id="scenario-panel" class="generation-panel">
            <div class="generation-header">
              <div class="generation-title">Scenario</div>
              <button id="scenario-reset" class="generation-button" type="button">Reset Scenario</button>
            </div>
            <div class="context-controls">
              <label class="context-label" for="scenario-select">Select</label>
              <select id="scenario-select" class="context-input"></select>
            </div>
            <div id="scenario-toggle" class="context-controls" hidden>
              <label class="context-label" for="prompt-toggle">Prompt A/B</label>
              <button id="prompt-toggle" class="generation-button" type="button">Use B</button>
            </div>
            <div id="scenario-summary" class="sampling-result"></div>
            <div id="scenario-intro" class="sampling-result"></div>
            <div id="scenario-objective" class="sampling-result"></div>
            <div id="scenario-failure" class="sampling-result"></div>
          </div>

          <div id="presets-panel" class="generation-panel">
            <div class="generation-header">
              <div class="generation-title">Presets</div>
              <button id="preset-save" class="generation-button" type="button">Save Preset</button>
            </div>
            <div id="presets-list" class="scores-list"></div>
          </div>

          <div id="settings-panel" class="generation-panel">
            <div class="generation-header">
              <div class="generation-title">Settings</div>
            </div>
            <div class="context-controls">
              <label class="context-label" for="settings-hints">Hints</label>
              <input id="settings-hints" type="checkbox" checked />
            </div>
            <div class="context-controls">
              <label class="context-label" for="settings-anim">Animation speed</label>
              <input id="settings-anim" class="sampling-input" type="number" step="0.1" min="0.2" value="1" />
            </div>
            <div class="context-controls">
              <label class="context-label" for="settings-sound">Sound</label>
              <input id="settings-sound" type="checkbox" />
            </div>
          </div>
        </section>
        <aside id="explain-panel" class="explain-panel">
          <div class="explain-header">
            <div class="generation-title">Explanation</div>
            <button id="explain-toggle" class="generation-button" type="button">Hide</button>
          </div>
          <div id="explain-content" class="explain-content"></div>
        </aside>
      </div>
    </div>

    <script type="module" src="./app.js"></script>
  </body>
</html>
